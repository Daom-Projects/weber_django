{% extends 'core/base.html' %}

{% block title %}
  {{ producto.nombre }}
{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-md-5">
      {% with primera_imagen=producto.archivos.all.first %}
        {% if primera_imagen and primera_imagen.ruta_archivo.url %}
          <img src="{{ primera_imagen.ruta_archivo.url }}" class="img-fluid rounded" alt="{{ producto.nombre }}" />
        {% else %}
          <div class="d-flex align-items-center justify-content-center bg-light rounded" style="height: 400px;">
            <span>Sin imagen disponible</span>
          </div>
        {% endif %}
      {% endwith %}
    </div>

    <div class="col-md-7">
<div class="col-md-7">
        <h1>{{ producto.nombre }}</h1>

        <div class="d-flex align-items-center mb-2" x-data="{ copied: false }">
            <p class="text-muted mb-0 me-2">
                SKU: <strong x-ref="sku">{{ producto.codigo|default:"N/A" }}</strong>
            </p>
            <button class="btn btn-sm btn-outline-secondary" @click="
                navigator.clipboard.writeText($refs.sku.innerText);
                copied = true;
                setTimeout(() => { copied = false }, 2000);
            ">
                <span x-show="!copied">Copiar</span>
                <span x-show="copied" style="display: none;">¡Copiado!</span>
            </button>
        </div>
        <hr>
        <h4>Descripción</h4>
      <p>{{ producto.descripcion|linebreaks }}</p>

      <h4>Detalles de Inventario</h4>
      <ul class="list-group list-group-flush">
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Stock Actual
          <span class="badge bg-primary rounded-pill">{{ producto.stock }}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Stock Mínimo
          <span class="badge bg-warning text-dark rounded-pill">{{ producto.stock_minimo }}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Estado
          <span class="badge bg-info">{{ producto.estado }}</span>
        </li>
      </ul>

      <h4 class="mt-4">Categorías</h4>
      <p>
        {% for categoria_asociada in producto.categoriaproducto_set.all %}
          <span class="badge bg-secondary">{{ categoria_asociada.categoria.nombre }}</span>
        {% empty %}
          Sin categorías asignadas.
        {% endfor %}
      </p>
      <a href="{% url 'productos:editar' pk=producto.pk %}" class="btn btn-warning mt-3">Editar Producto</a>
      <a href="{% url 'productos:eliminar' pk=producto.pk %}" class="btn btn-danger mt-3">Eliminar</a>
      <a href="{% url 'productos:lista' %}" class="btn btn-outline-secondary mt-3">Volver a la lista</a>
    </div>
  </div>
{% endblock %}
